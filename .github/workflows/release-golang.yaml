---
name: Release-Golang
on:
  workflow_dispatch:
    inputs:
      release-tag:
        required: false
        type: string
  push:
    tags:
      - '*'

jobs:
  Create-Git-Tag:
    name: Create Git Tag
    uses: stuttgart-things/stuttgart-things/.github/workflows/call-git-tag.yaml@main
    if: github.ref_type != 'tag' && github.event.inputs.release-tag != ''
    with:
      tag-name: ${{ github.event.inputs.release-tag }}
      environment-name: k8s
      runs-on: ghr-machineshop-labda-test
      alpine-version: 3.19.0
      continue-error: false
    secrets: inherit

  Release-Golang-Binaries:
    name: Release Golang
    uses: stuttgart-things/stuttgart-things/.github/workflows/call-golang-release.yaml@main
    if: always()
    needs: Create-Git-Tag
    with:
      module-name: machineShop
      environment-name: k8s
      runs-on: ghr-machineshop-labda-test
      goreleaser-version: v1.26.2
      golang-version: 1.22.3
    secrets: inherit
